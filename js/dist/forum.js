(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("huseyinfiliz/custom-profile-page",function(){});const e=flarum.core.compat["forum/app"];var r=t.n(e);function n(t,o){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},n(t,o)}function a(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,n(t,o)}const i=flarum.core.compat["common/Model"];var s=t.n(i),u=function(t){function o(){for(var o,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(o=t.call.apply(t,[this].concat(r))||this).content=s().attribute("content"),o.updatedAt=s().attribute("updatedAt",s().transformDate),o.user=s().hasOne("user"),o}return a(o,t),o}(s());const l=flarum.core.compat["common/extend"],c=flarum.core.compat["forum/components/UserPage"];var f=t.n(c);const d=flarum.core.compat["common/components/LinkButton"];var p=t.n(d);const g=flarum.core.compat["common/components/LoadingIndicator"];var h=t.n(g);const y=flarum.core.compat["common/components/Button"];var v=t.n(y);const P=flarum.core.compat["common/components/Modal"];var b=t.n(P);const C=flarum.core.compat["common/components/TextEditor"];var _=t.n(C);const w=flarum.core.compat["common/utils/Stream"];var z=t.n(w),x=function(t){function o(){for(var o,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(o=t.call.apply(t,[this].concat(r))||this).contentText=void 0,o.loading=!1,o.useEditor=!1,o}a(o,t);var e=o.prototype;return e.oninit=function(o){var e;t.prototype.oninit.call(this,o),this.contentText=z()((null==(e=this.attrs.customPage)?void 0:e.content())||"");var n=r().forum.attribute("huseyinfiliz-custom-profile-page.content_format")||"markdown";this.useEditor="markdown"===n},e.className=function(){return"EditCustomPageModal Modal--large"},e.title=function(){return r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.title")},e.content=function(){return m(".Modal-body",[m(".Form",[m(".Form-group",[m("label",r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_label")),this.useEditor?this.renderEditor():this.renderTextarea()]),m(".Form-group",[v().component({type:"submit",className:"Button Button--primary",loading:this.loading,disabled:this.loading},r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.submit_button"))])])])},e.renderEditor=function(){var t=this;return m(_(),{composer:this,submitLabel:r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.submit_button"),placeholder:r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_placeholder"),onchange:function(o){t.contentText(o)},onsubmit:function(){t.onsubmit(new Event("submit"))},value:this.contentText(),disabled:this.loading})},e.renderTextarea=function(){var t=this;return m("textarea.FormControl",{rows:15,value:this.contentText(),oninput:function(o){t.contentText(o.target.value)},placeholder:r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_placeholder"),disabled:this.loading})},e.onsubmit=function(t){var o=this;if(t.preventDefault(),!this.loading){this.loading=!0;var e=this.attrs.user.id(),n={type:"custom-profile-pages",attributes:{content:this.contentText()}},a=this.attrs.customPage?"PATCH":"POST",i=r().forum.attribute("apiUrl")+"/users/"+e+"/custom-page";r().request({method:a,url:i,body:{data:n}}).then(function(){o.loading=!1,o.hide(),o.attrs.onSave(),m.redraw()}).catch(function(t){console.error("Save error:",t),o.loading=!1,r().alerts.show({type:"error"},r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.error")),m.redraw()})}},o}(b()),E=function(t){function o(){for(var o,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(o=t.call.apply(t,[this].concat(r))||this).loading=!1,o.customPage=null,o.error=null,o}a(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=!0,this.loadUser(this.attrs.username),console.log("CustomProfilePage initialized",this.attrs)},e.oncreate=function(o){var e=this;t.prototype.oncreate.call(this,o),this.user?this.loadCustomPage():setTimeout(function(){e.user&&e.loadCustomPage()},100)},e.content=function(){var t,o,e=this;if(!this.user)return console.log("Waiting for user..."),m(".CustomProfilePage",m(h()));if(this.loading)return m(".CustomProfilePage",[m("h2",this.user.displayName()+"'s Custom Page"),m(h())]);if(this.error)return m(".CustomProfilePage",m(".Alert.Alert--error",this.error));var n=(null==(t=r().session.user)?void 0:t.id())===this.user.id()&&r().forum.attribute("canEditOwnCustomPage"),a=null==(o=this.customPage)?void 0:o.content(),i=r().forum.attribute("huseyinfiliz-custom-profile-page.content_format")||"markdown";return console.log("Rendering content",{content:a,format:i,canEdit:n}),m(".CustomProfilePage",[n&&m(".CustomProfilePage-actions",m(v(),{className:"Button Button--primary",icon:"fas fa-edit",onclick:function(){console.log("Opening edit modal"),r().modal.show(x,{user:e.user,customPage:e.customPage,onSave:function(){console.log("Modal saved, reloading"),e.loadCustomPage()}})}},r().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.edit_button"))),m(".CustomProfilePage-content",a?this.renderContent(a,i):this.renderEmpty(n))])},e.loadCustomPage=function(){var t=this;if(!this.user)return console.log("No user yet, waiting..."),void setTimeout(function(){return t.loadCustomPage()},100);this.loading=!0,this.error=null,console.log("Loading custom page for user:",this.user.id()),r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/users/"+this.user.id()+"/custom-page"}).then(function(o){console.log("Custom page loaded:",o),o.data&&(t.customPage=r().store.pushPayload(o)),t.loading=!1,m.redraw()}).catch(function(o){console.error("Custom page load error:",o),404===o.status?(console.log("No custom page yet (404)"),t.customPage=null):(console.error("Real error:",o),t.error="Failed to load custom page"),t.loading=!1,m.redraw()})},e.renderContent=function(t,o){if("html"===o)return m.trust(t);if("markdown"===o){var e=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");return m.trust(e)}return m("pre",t)},e.renderEmpty=function(t){return m(".CustomProfilePage-empty",[m("p",r().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.empty")),t&&m("p.help-text",'Click "Edit" to create your custom page')])},o}(f());r().initializers.add("huseyinfiliz/custom-profile-page",function(){r().store.models["custom-profile-pages"]=u,r().routes["user.customPage"]={path:"/u/:username/customPage",component:E},(0,l.extend)(f().prototype,"navItems",function(t){var o,e=this.user;if(e){var n=r().forum.attribute("canViewCustomPage"),a=(null==(o=r().session.user)?void 0:o.id())===e.id()&&r().forum.attribute("canEditOwnCustomPage");if(n||a){var i=r().forum.attribute("huseyinfiliz-custom-profile-page.tab_title")||"Custom Page",s=r().forum.attribute("huseyinfiliz-custom-profile-page.tab_icon")||"fas fa-file-alt";t.add("customPageLink",p().component({href:r().route("user.customPage",{username:e.slug()}),name:"custompage",icon:s},i),85)}}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map