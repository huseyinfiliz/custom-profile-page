(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("huseyinfiliz/custom-profile-page",function(){});const e=flarum.core.compat["forum/app"];var n=t.n(e);const r=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/UserPage"];var i=t.n(a);const u=flarum.core.compat["common/components/LinkButton"];var s=t.n(u);function c(t,o){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},c(t,o)}function l(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,c(t,o)}const f=flarum.core.compat["common/Model"];var p=t.n(f),d=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).content=p().attribute("content"),o.updatedAt=p().attribute("updatedAt",p().transformDate),o.user=p().hasOne("user"),o}return l(o,t),o}(p());const g=flarum.core.compat["common/Component"];var h=t.n(g);const y=flarum.core.compat["common/components/LoadingIndicator"];var v=t.n(y);const P=flarum.core.compat["common/components/Button"];var b=t.n(P);const _=flarum.core.compat["common/components/Modal"];var w=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).content="",o.loading=!1,o}l(o,t);var e=o.prototype;return e.oninit=function(o){var e;t.prototype.oninit.call(this,o),this.content=(null==(e=this.attrs.customPage)?void 0:e.content())||""},e.className=function(){return"EditCustomPageModal Modal--large"},e.title=function(){return n().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.title")},e.content=function(){var t=this;return m(".Modal-body",m(".Form",[m(".Form-group",[m("label",n().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_label")),m("textarea.FormControl",{rows:15,value:this.content,oninput:function(o){return t.content=o.target.value},placeholder:n().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_placeholder")})]),m(".Form-group",b().component({type:"submit",className:"Button Button--primary",loading:this.loading},n().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.submit_button")))]))},e.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0;var e=this.attrs.user.id(),r={type:"custom-profile-pages",attributes:{content:this.content}},a=this.attrs.customPage?"PATCH":"POST",i=(this.attrs.customPage,n().forum.attribute("apiUrl")+"/users/"+e+"/custom-page");n().request({method:a,url:i,body:{data:r}}).then(function(){o.loading=!1,o.hide(),o.attrs.onSave(),m.redraw()}).catch(function(){o.loading=!1,m.redraw()})},o}(t.n(_)()),C=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loading=!1,o.customPage=null,o}l(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.load()},e.load=function(){var t=this,o=this.attrs.user;this.loading=!0,n().store.find("custom-profile-pages",o.id()).then(function(o){t.customPage=o,t.loading=!1,m.redraw()}).catch(function(){t.loading=!1,m.redraw()})},e.view=function(){var t,o,e=this,r=this.attrs.user,a=(null==(t=n().session.user)?void 0:t.id())===r.id()&&n().forum.attribute("canEditOwnCustomPage");if(this.loading)return m(v());var i=null==(o=this.customPage)?void 0:o.content(),u=n().forum.attribute("huseyinfiliz-custom-profile-page.content_format")||"markdown";return m(".CustomProfilePage",[a&&m(".CustomProfilePage-actions",m(b(),{className:"Button Button--primary",icon:"fas fa-edit",onclick:function(){return n().modal.show(w,{user:r,customPage:e.customPage,onSave:function(){return e.load()}})}},n().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.edit_button"))),m(".CustomProfilePage-content",i?this.renderContent(i,u):this.renderEmpty(a))])},e.renderContent=function(t,o){if("html"===o)return m.trust(t);if("markdown"===o){var e=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");return m.trust(e)}return m("pre",t)},e.renderEmpty=function(t){return m(".CustomProfilePage-empty",n().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.empty"))},o}(h());n().initializers.add("huseyinfiliz/custom-profile-page",function(){n().store.models["custom-profile-pages"]=d,(0,r.extend)(i().prototype,"navItems",function(t){var o,e=this.user,r=n().forum.attribute("canViewCustomPage"),a=(null==(o=n().session.user)?void 0:o.id())===(null==e?void 0:e.id())&&n().forum.attribute("canEditOwnCustomPage");if(r||a){var i=n().forum.attribute("huseyinfiliz-custom-profile-page.tab_title")||"Custom Page",u=n().forum.attribute("huseyinfiliz-custom-profile-page.tab_icon")||"fas fa-file-alt";t.add("customPage",s().component({href:n().route("user.customPage",{username:null==e?void 0:e.slug()}),icon:u},i),10)}}),(0,r.extend)(i().prototype,"content",function(t){if("user.customPage"===this.attrs.routeName)return m(C,{user:this.user})}),n().routes["user.customPage"]={path:"/u/:username/custom-page",component:i(),resolverClass:i()}})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map