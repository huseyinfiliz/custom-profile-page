(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("huseyinfiliz/custom-profile-page",function(){});const e=flarum.core.compat["forum/app"];var r=t.n(e);function a(t,o){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},a(t,o)}function n(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,a(t,o)}const i=flarum.core.compat["common/Model"];var s=t.n(i),u=function(t){function o(){for(var o,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(o=t.call.apply(t,[this].concat(r))||this).content=s().attribute("content"),o.updatedAt=s().attribute("updatedAt",s().transformDate),o.user=s().hasOne("user"),o}return n(o,t),o}(s());const l=flarum.core.compat["common/extend"],c=flarum.core.compat["forum/components/UserPage"];var f=t.n(c);const d=flarum.core.compat["common/components/LinkButton"];var p=t.n(d);const h=flarum.core.compat["common/components/LoadingIndicator"];var g=t.n(h);const b=flarum.core.compat["common/components/Button"];var y=t.n(b);const v=flarum.core.compat["common/components/Modal"];var P=t.n(v);const w=flarum.core.compat["common/utils/Stream"];var _=t.n(w),B=function(t){function o(){for(var o,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(o=t.call.apply(t,[this].concat(r))||this).contentText=void 0,o.loading=!1,o.textareaElement=null,o}n(o,t);var e=o.prototype;return e.oninit=function(o){var e;t.prototype.oninit.call(this,o);var a="";a=null!=(e=this.attrs.customPage)&&e.content()?this.attrs.customPage.content():r().forum.attribute("huseyinfiliz-custom-profile-page.default_template")||"",this.contentText=_()(a)},e.className=function(){return"EditCustomPageModal Modal--large"},e.title=function(){return r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.title")},e.content=function(){var t=this,o=r().forum.attribute("huseyinfiliz-custom-profile-page.content_format")||"markdown",e="markdown"===o;return m(".Modal-body",[m(".Form",[this.renderFormatInfo(o),e&&this.renderMarkdownToolbar(),m(".Form-group",[this.renderTextarea()]),m(".Form-group.EditCustomPageModal-actions",[y().component({type:"submit",className:"Button Button--primary",loading:this.loading,disabled:this.loading,onclick:this.onsubmit.bind(this)},r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.submit_button"))," ",y().component({className:"Button",disabled:this.loading,onclick:function(){return t.hide()}},r().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.cancel_button"))])])])},e.renderFormatInfo=function(t){var o="",e="";return"markdown"===t?(o="fab fa-markdown",e="You can use Markdown formatting: **bold**, *italic*, [link](url), `code`, etc."):"html"===t?(o="fab fa-html5",e="You can use the following HTML tags: "+(r().forum.attribute("huseyinfiliz-custom-profile-page.allowed_html_tags")||"")):(o="fas fa-align-left",e="Plain text only. No HTML or Markdown formatting allowed."),m(".Alert.EditCustomPageModal-formatInfo",[m("i.icon",{className:o}),m("span",e)])},e.renderMarkdownToolbar=function(){return m(".MarkdownToolbar.ButtonGroup",[this.toolbarButton("Heading","fas fa-heading","\n## ",""),this.toolbarButton("Bold","fas fa-bold","**","**"),this.toolbarButton("Italic","fas fa-italic","*","*"),this.toolbarButton("Strikethrough","fas fa-strikethrough","~~","~~"),this.toolbarButton("Quote","fas fa-quote-left","\n> ",""),this.toolbarButton("Spoiler","fas fa-eye-slash",">!","!<"),this.toolbarButton("Code","fas fa-code","`","`"),this.toolbarButton("Link","fas fa-link","[","](url)"),this.toolbarButton("Image","fas fa-image","![","](image-url)"),this.toolbarButton("Bulleted List","fas fa-list-ul","\n- ",""),this.toolbarButton("Numbered List","fas fa-list-ol","\n1. ",""),this.toolbarButton("Mention","fas fa-at","@","")])},e.toolbarButton=function(t,o,e,r){var a=this;return m("button.Button.Button--icon.Button--link",{type:"button",title:t,onclick:function(t){t.preventDefault(),a.insertMarkdown(e,r)}},m("i",{className:o}))},e.insertMarkdown=function(t,o){if(this.textareaElement){var e=this.textareaElement,r=e.selectionStart,a=e.selectionEnd,n=this.contentText(),i=n.substring(r,a),s=n.substring(0,r)+t+i+o+n.substring(a);this.contentText(s),setTimeout(function(){var o=r+t.length+i.length;e.focus(),e.setSelectionRange(o,o),m.redraw()},0)}},e.renderTextarea=function(){var t=this;return m("textarea.FormControl",{rows:20,value:this.contentText(),oninput:function(o){t.contentText(o.target.value)},oncreate:function(o){t.textareaElement=o.dom},placeholder:r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_placeholder"),disabled:this.loading})},e.onsubmit=function(t){var o=this;if(t&&t.preventDefault(),!this.loading){this.loading=!0;var e=this.attrs.user.id(),a={type:"custom-profile-pages",attributes:{content:this.contentText()}},n=this.attrs.customPage?"PATCH":"POST",i=r().forum.attribute("apiUrl")+"/users/"+e+"/custom-page";r().request({method:n,url:i,body:{data:a}}).then(function(t){if(o.loading=!1,t.data){var e=r().store.pushPayload(t);o.attrs.onSave&&o.attrs.onSave(e)}o.hide(),m.redraw()}).catch(function(){o.loading=!1,r().alerts.show({type:"error"},r().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.error")),m.redraw()})}},o}(P()),k=function(t){function o(){for(var o,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(o=t.call.apply(t,[this].concat(r))||this).loading=!0,o.error=null,o.customPage=null,o.permissionDenied=!1,o}n(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=!0,this.error=null,this.customPage=null,this.permissionDenied=!1,this.loadUser(m.route.param("username"))},e.show=function(o){t.prototype.show.call(this,o),this.loadCustomPage()},e.oncreate=function(o){t.prototype.oncreate.call(this,o),this.processMediaLinks()},e.onupdate=function(o){t.prototype.onupdate.call(this,o),this.processMediaLinks()},e.processMediaLinks=function(){var t=this;r().forum.attribute("huseyinfiliz-custom-profile-page.enable_media_embeds")&&setTimeout(function(){var o,e=null==(o=t.element)?void 0:o.querySelector(".CustomProfilePage-content");e&&e.querySelectorAll('a[href*="youtube.com"], a[href*="youtu.be"]').forEach(function(t){if(!t.classList.contains("media-processed")){var o=t.getAttribute("href");if(o){var e=null,r=o.match(/[?&]v=([^&]+)/);r&&(e=r[1]);var a=o.match(/youtu\.be\/([^?]+)/);if(a&&(e=a[1]),e){var n=document.createElement("iframe");n.src="https://www.youtube.com/embed/"+e,n.width="560",n.height="315",n.frameBorder="0",n.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",n.allowFullscreen=!0,n.style.maxWidth="100%",n.style.marginTop="10px",n.style.marginBottom="10px";var i=t.parentElement;i&&(i.appendChild(n),t.classList.add("media-processed"),t.style.display="none")}}}})},100)},e.content=function(){var t,o,e=this;if(this.loading)return m(g(),null);if(this.permissionDenied)return m("div",{className:"CustomProfilePage"},m("div",{className:"Placeholder"},m("p",null,r().translator.trans("huseyinfiliz-custom-profile-page.forum.errors.permission_denied"))));if(this.error)return m("div",{className:"CustomProfilePage"},m("div",{className:"Placeholder"},m("p",null,this.error)));var a=r().session.user;if(!a){var n,i=(null==(n=this.customPage)?void 0:n.attribute("contentHtml"))||"";return m("div",{className:"CustomProfilePage"},m("div",{className:"CustomProfilePage-content Post-body"},i?m.trust(i):this.renderEmpty(!1)))}var s=r().forum.attribute("canModerateCustomPage"),u=a.id()===(null==(t=this.user)?void 0:t.id()),l=r().forum.attribute("canEditOwnCustomPage"),c=s||u&&l,f=(null==(o=this.customPage)?void 0:o.attribute("contentHtml"))||"";return m("div",{className:"CustomProfilePage"},m("div",{className:"CustomProfilePage-header"},c&&m(y(),{className:"Button Button--primary",icon:"fas fa-edit",onclick:function(){r().modal.show(B,{user:e.user,customPage:e.customPage,onSave:function(t){e.customPage=t,m.redraw()}})}},r().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.edit_button"))),m("div",{className:"CustomProfilePage-content Post-body"},f?m.trust(f):this.renderEmpty(c)))},e.loadCustomPage=function(){var t=this;this.user?(this.loading=!0,this.error=null,this.permissionDenied=!1,this.customPage=null,r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/users/"+this.user.id()+"/custom-page"}).then(function(o){o.data&&(t.customPage=r().store.pushPayload(o))}).catch(function(o){403===o.status?t.permissionDenied=!0:404===o.status?t.customPage=null:t.error=r().translator.trans("huseyinfiliz-custom-profile-page.forum.errors.load_failed")}).finally(function(){t.loading=!1,m.redraw()})):setTimeout(function(){return t.loadCustomPage()},100)},e.renderEmpty=function(t){return m("div",{className:"Placeholder"},m("p",null,t?r().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.empty_own"):r().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.empty_other")))},o}(f());r().initializers.add("huseyinfiliz/custom-profile-page",function(){console.log("[huseyinfiliz/custom-profile-page] Custom Profile Page extension enabled"),r().store.models["custom-profile-pages"]=u,r().routes["user.customPage"]={path:"/u/:username/:slug",component:k,resolverClass:function(){function t(){}return t.prototype.onmatch=function(t){var o,e=(null==(o=r().forum)?void 0:o.attribute("huseyinfiliz-custom-profile-page.url_slug"))||"customPage";if(t.slug===e)return k},t}()},(0,l.extend)(f().prototype,"navItems",function(t){var o,e,a,n,i,s,u=this.user;if(u){var l=null==(o=r().forum)?void 0:o.attribute("canViewCustomPage"),m=(null==(e=r().session.user)?void 0:e.id())===u.id()&&(null==(a=r().forum)?void 0:a.attribute("canEditOwnCustomPage"));if(l||m){var c=(null==(n=r().forum)?void 0:n.attribute("huseyinfiliz-custom-profile-page.url_slug"))||"customPage",f=(null==(i=r().forum)?void 0:i.attribute("huseyinfiliz-custom-profile-page.tab_title"))||"Custom Page",d=(null==(s=r().forum)?void 0:s.attribute("huseyinfiliz-custom-profile-page.tab_icon"))||"fas fa-file-alt";t.add("customPageLink",p().component({href:"/u/"+u.slug()+"/"+c,name:"custompage",icon:d},f),85)}}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map