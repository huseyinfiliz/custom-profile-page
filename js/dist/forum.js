(()=>{var t={n:o=>{var r=o&&o.__esModule?()=>o.default:()=>o;return t.d(r,{a:r}),r},d:(o,r)=>{for(var e in r)t.o(r,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:r[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("huseyinfiliz/custom-profile-page",function(){});const r=flarum.core.compat["forum/app"];var e=t.n(r);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/UserPage"];var i=t.n(a);const u=flarum.core.compat["common/components/LinkButton"];var s=t.n(u);function c(t,o){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},c(t,o)}function l(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,c(t,o)}const f=flarum.core.compat["common/Model"];var p=t.n(f),d=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return(o=t.call.apply(t,[this].concat(e))||this).content=p().attribute("content"),o.updatedAt=p().attribute("updatedAt",p().transformDate),o.user=p().hasOne("user"),o}return l(o,t),o}(p());const g=flarum.core.compat["common/Component"];var h=t.n(g);const y=flarum.core.compat["common/components/LoadingIndicator"];var v=t.n(y);const P=flarum.core.compat["common/components/Button"];var b=t.n(P);const _=flarum.core.compat["common/components/Modal"];var C=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return(o=t.call.apply(t,[this].concat(e))||this).content="",o.loading=!1,o}l(o,t);var r=o.prototype;return r.oninit=function(o){var r;t.prototype.oninit.call(this,o),this.content=(null==(r=this.attrs.customPage)?void 0:r.content())||""},r.className=function(){return"EditCustomPageModal Modal--large"},r.title=function(){return e().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.title")},r.content=function(){var t=this;return m(".Modal-body",m(".Form",[m(".Form-group",[m("label",e().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_label")),m("textarea.FormControl",{rows:15,value:this.content,oninput:function(o){return t.content=o.target.value},placeholder:e().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.content_placeholder")})]),m(".Form-group",b().component({type:"submit",className:"Button Button--primary",loading:this.loading},e().translator.trans("huseyinfiliz-custom-profile-page.forum.edit_modal.submit_button")))]))},r.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0;var r=this.attrs.user.id(),n={type:"custom-profile-pages",attributes:{content:this.content}},a=this.attrs.customPage?"PATCH":"POST",i=(this.attrs.customPage,e().forum.attribute("apiUrl")+"/users/"+r+"/custom-page");e().request({method:a,url:i,body:{data:n}}).then(function(){o.loading=!1,o.hide(),o.attrs.onSave(),m.redraw()}).catch(function(){o.loading=!1,m.redraw()})},o}(t.n(_)()),w=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return(o=t.call.apply(t,[this].concat(e))||this).loading=!1,o.customPage=null,o.error=null,o}l(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o),this.load()},r.load=function(){var t=this,o=this.attrs.user;o&&o.id()?(this.loading=!0,this.error=null,e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/users/"+o.id()+"/custom-page"}).then(function(o){o.data&&(t.customPage=e().store.pushPayload(o)),t.loading=!1,m.redraw()}).catch(function(o){console.error("Custom page load error:",o),404===o.status?t.customPage=null:t.error="Failed to load custom page",t.loading=!1,m.redraw()})):this.error="User not found"},r.view=function(){var t,o,r=this,n=this.attrs.user,a=(null==(t=e().session.user)?void 0:t.id())===n.id()&&e().forum.attribute("canEditOwnCustomPage");if(this.loading)return m(".CustomProfilePage",m(v()));if(this.error)return m(".CustomProfilePage",m(".Alert.Alert--error",this.error));var i=null==(o=this.customPage)?void 0:o.content(),u=e().forum.attribute("huseyinfiliz-custom-profile-page.content_format")||"markdown";return m(".CustomProfilePage",[a&&m(".CustomProfilePage-actions",m(b(),{className:"Button Button--primary",icon:"fas fa-edit",onclick:function(){return e().modal.show(C,{user:n,customPage:r.customPage,onSave:function(){return r.load()}})}},e().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.edit_button"))),m(".CustomProfilePage-content",i?this.renderContent(i,u):this.renderEmpty(a))])},r.renderContent=function(t,o){if("html"===o)return m.trust(t);if("markdown"===o){var r=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");return m.trust(r)}return m("pre",t)},r.renderEmpty=function(t){return m(".CustomProfilePage-empty",e().translator.trans("huseyinfiliz-custom-profile-page.forum.profile_tab.empty"))},o}(h());e().initializers.add("huseyinfiliz/custom-profile-page",function(){e().store.models["custom-profile-pages"]=d,e().routes["user.customPage"]={path:"/u/:username/customPage",component:i()},(0,n.extend)(i().prototype,"navItems",function(t){var o,r=this.user;if(r){var n=e().forum.attribute("canViewCustomPage"),a=(null==(o=e().session.user)?void 0:o.id())===r.id()&&e().forum.attribute("canEditOwnCustomPage");if(n||a){var i=e().forum.attribute("huseyinfiliz-custom-profile-page.tab_title")||"Custom Page",u=e().forum.attribute("huseyinfiliz-custom-profile-page.tab_icon")||"fas fa-file-alt";t.add("customPage",s().component({href:e().route("user.customPage",{username:r.slug()}),icon:u},i),10)}}}),(0,n.override)(i().prototype,"content",function(t){var o=m.route.get();return o&&o.includes("/customPage")?m(w,{user:this.user}):t()})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map